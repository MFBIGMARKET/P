<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PVR - Sales and Inventory</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50"/>
    <style>
        :root {
            --primary-color: #2196F3; /* Blue */
            --secondary-color: #4CAF50; /* Green */
            --danger-color: #f44336;  /* Red */
            --warning-color: #FFC107; /* Amber for Purchases */
            --light-color: #f4f4f4;
            --dark-color: #333;
            --white-color: #fff;
            --padding: 16px;
            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        *, *::before, *::after { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0; background-color: var(--light-color); color: var(--dark-color);
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }

        .container { padding: var(--padding); padding-bottom: 80px; }
        .page-header { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 20px; color: var(--dark-color); }
        .page-header .icon { width: 28px; height: 28px; }

        /* Login Screen */
        #login-screen { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); padding: var(--padding); }
        #login-header { position: absolute; top: 40px; color: var(--white-color); font-size: 2em; font-weight: bold; letter-spacing: 1px; }
        #role-selection { text-align: center; }
        #role-selection p { font-size: 1.2em; color: var(--white-color); margin-bottom: 20px; }
        #login-button { background: rgba(255, 255, 255, 0.9); border: none; border-radius: var(--border-radius); width: 120px; height: 120px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.25); transition: transform 0.2s ease, background-color 0.2s ease; }
        #login-button:hover { transform: scale(1.05); background: var(--white-color); }
        #login-button .icon { width: 40px; height: 40px; color: var(--primary-color); }
        #login-button span { font-size: 1.1em; font-weight: bold; color: var(--dark-color); }

        /* Main App & Navigation */
        #main-app { display: none; }
        #bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 65px; background-color: var(--white-color); display: flex; justify-content: space-around; align-items: center; box-shadow: 0 -2px 5px rgba(0,0,0,0.1); z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; flex-grow: 1; height: 100%; cursor: pointer; color: #888; border-top: 3px solid transparent; transition: color 0.3s ease, border-color 0.3s ease; font-size: 0.75em; }
        .nav-item .icon { width: 24px; height: 24px; margin-bottom: 4px; }
        .nav-item:hover { color: var(--primary-color); }
        .nav-item.active { color: var(--primary-color); border-top-color: var(--primary-color); }
        
        /* Pages & Lists */
        .page { display: none; } .page.active { display: block; }
        .item-list { list-style: none; padding: 0; margin: 0; }
        .list-item { background-color: var(--white-color); padding: var(--padding); margin-bottom: 12px; border-radius: var(--border-radius); box-shadow: var(--box-shadow); display: flex; justify-content: space-between; align-items: center; }
        .btn { padding: 8px 16px; border: none; color: white; border-radius: 5px; cursor: pointer; font-weight: bold; transition: opacity 0.2s; }
        .btn:hover { opacity: 0.9; }
        .order-btn { background-color: var(--secondary-color); }
        .purchase-btn { background-color: var(--warning-color); color: var(--dark-color); }
        .edit-btn { background-color: var(--primary-color); } .view-bill-btn { background-color: #607D8B; }
        .mark-paid-btn { background-color: var(--secondary-color); font-size: 0.8em; padding: 6px 10px; }

        /* FAB */
        .fab { position: fixed; bottom: 85px; right: 20px; width: 56px; height: 56px; background-color: var(--danger-color); color: var(--white-color); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 28px; box-shadow: 0 4px 12px rgba(0,0,0,0.25); cursor: pointer; transition: transform 0.2s ease; z-index: 100; }
        .fab:hover { transform: scale(1.05); }

        /* Modal Styling */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 10vh auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 500px; border-radius: var(--border-radius); animation: slide-down 0.3s ease-out; }
        @keyframes slide-down { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-content input, .modal-content select { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; background-color: white; }
        .modal-buttons { text-align: right; margin-top: 10px; } .modal-buttons .btn { margin-left: 10px; }
        .save-btn { background-color: var(--secondary-color); } .close-btn { background-color: #aaa; }
        .modal-content input[readonly] { background-color: #e9ecef; cursor: not-allowed; opacity: 0.8; }

        /* Order & Purchase Creation Pages */
        .page-sub-header { text-align: center; margin-bottom: 16px; }
        .page-sub-header h2 { font-size: 1.5em; margin: 0 0 10px 0; }
        .search-container { display: flex; align-items: center; gap: 10px; width: 100%; }
        .search-container .search-bar { flex-grow: 1; padding: 12px; border-radius: 25px; border: 1px solid #ccc; font-size: 16px; }
        .search-container .cart-icon { font-size: 28px; position: relative; cursor: pointer; padding: 8px; }
        .cart-icon .cart-count { position: absolute; top: 0px; right: 0px; background-color: var(--danger-color); color: white; border-radius: 50%; padding: 2px 6px; font-size: 12px; font-weight: bold; }
        .product-grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
        @media (min-width: 768px) { .product-grid { grid-template-columns: repeat(2, 1fr); } }

        .product-tile { background: var(--white-color); padding: var(--padding); border-radius: var(--border-radius); box-shadow: var(--box-shadow); }
        .product-info { display: flex; justify-content: space-between; margin-bottom: 12px; align-items: center; }
        .product-name { font-weight: bold; font-size: 1.1em; } .product-mrp { color: #555; font-size: 0.9em; }
        .product-actions { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; align-items: stretch; }
        .purchase-actions { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 6px; align-items: stretch; }
        .action-item { text-align: center; }
        .action-item .control { display: flex; justify-content: center; align-items: center; height: 40px; padding: 5px; text-align: center; border-radius: 5px; border: 1px solid #ccc; background-color: var(--light-color); cursor: pointer; font-size: 16px; width: 100%; -moz-appearance: textfield; transition: background-color 0.2s, border-color 0.2s; }
        .action-item input.control { cursor: text; }
        .action-item input.control::-webkit-outer-spin-button, .action-item input.control::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .action-item .label { font-size: 0.75em; color: #666; margin-top: 4px; }
        .price-btn.selected { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        .control.add-to-cart-btn, .control.add-to-purchase-btn { background-color: var(--danger-color); color: white; border-color: var(--danger-color); font-weight: bold; }

        /* Accounts Page */
        .sub-nav { display: flex; background-color: var(--white-color); border-radius: var(--border-radius); margin-bottom: var(--padding); box-shadow: var(--box-shadow); }
        .sub-nav-item { flex: 1; padding: 12px; text-align: center; cursor: pointer; border-bottom: 3px solid transparent; color: #888; font-weight: bold; }
        .sub-nav-item.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .sub-page { display: none; } .sub-page.active { display: block; }

        /* Reports Page */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--padding); }
        .kpi-card { background-color: var(--white-color); padding: var(--padding); border-radius: var(--border-radius); box-shadow: var(--box-shadow); text-align: center; margin-bottom: var(--padding); }
        .kpi-card h3 { margin: 0 0 10px 0; color: #777; font-weight: 500; }
        .kpi-card .value { font-size: 2.5em; font-weight: bold; color: var(--dark-color); }
        .kpi-card.sales .value { color: var(--secondary-color); }
        .kpi-card.purchases .value { color: var(--warning-color); }
        .kpi-card.profit .value { color: var(--primary-color); }
        .report-section { background: var(--white-color); padding: var(--padding); border-radius: var(--border-radius); box-shadow: var(--box-shadow); margin-bottom: var(--padding); }
        .report-section h3 { text-align: center; margin-top: 0; }
        .report-table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        .report-table th, .report-table td { padding: 8px; text-align: left; border-bottom: 1px solid #eee; }
        .report-table th { font-weight: bold; }
        .report-table td:not(:first-child) { text-align: right; }

        /* Cart & Bill Modals */
        .cart-items-list { list-style: none; padding: 0; } .cart-items-list li { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
        .cart-item-details { display: flex; align-items: center; gap: 15px; }
        .delete-cart-item-btn { background: none; border: none; font-size: 20px; cursor: pointer; color: #aaa; padding: 5px; }
        .delete-cart-item-btn:hover { color: var(--danger-color); }
        .cart-total { font-weight: bold; font-size: 1.2em; text-align: right; margin-top: 15px; }
        #confirm-order-btn, #confirm-purchase-btn { background-color: var(--secondary-color); }
        #bill-modal .modal-content { padding: 0; max-width: 800px; }
        .bill-container { padding: 30px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #333; }
        .bill-header { text-align: center; border-bottom: 2px solid var(--light-color); padding-bottom: 15px; margin-bottom: 20px; }
        .bill-header h2 { margin: 0; color: var(--primary-color); font-size: 2em; } .bill-header p { margin: 5px 0 0; color: #777; }
        .bill-meta { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .bill-meta-item { text-align: right; } .bill-meta-item strong { display: block; color: #555; margin-bottom: 4px; } .bill-meta-item span { color: #888; }
        .bill-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; } .bill-table thead { background-color: var(--primary-color); color: white; }
        .bill-table th, .bill-table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        .bill-table th:first-child, .bill-table td:first-child { text-align: center; }
        .bill-table th:not(:first-child), .bill-table td:not(:first-child) { text-align: right; }
        .bill-table td { color: #555; }
        .bill-summary { display: flex; justify-content: flex-end; } .bill-summary table { width: 50%; max-width: 250px; }
        .bill-summary td { padding: 8px 12px; } .bill-summary .total { font-weight: bold; font-size: 1.2em; background-color: var(--light-color); }
        .bill-summary .total td { color: var(--secondary-color); }
        .bill-footer { text-align: center; margin-top: 30px; padding-top: 15px; border-top: 1px solid #eee; color: #999; font-size: 0.9em; }

        /* Success Animation */
        #success-animation { display: none; position: fixed; z-index: 2000; left: 50%; top: 50%; transform: translate(-50%, -50%); background-color: var(--white-color); padding: 30px; border-radius: var(--border-radius); box-shadow: 0 5px 20px rgba(0,0,0,0.3); text-align: center; }
        .checkmark { width: 80px; height: 80px; border-radius: 50%; display: block; stroke-width: 2; stroke: var(--secondary-color); stroke-miterlimit: 10; box-shadow: inset 0px 0px 0px var(--secondary-color); animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both; margin: 0 auto; }
        .checkmark__circle { stroke-dasharray: 166; stroke-dashoffset: 166; stroke-width: 2; stroke-miterlimit: 10; stroke: var(--secondary-color); fill: none; animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards; }
        .checkmark__check { transform-origin: 50% 50%; stroke-dasharray: 48; stroke-dashoffset: 48; stroke: var(--white-color); stroke-width: 4; animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards; }
        @keyframes stroke { 100% { stroke-dashoffset: 0; } } @keyframes scale { 0%, 100% { transform: none; } } @keyframes fill { 100% { box-shadow: inset 0px 0px 0px 40px var(--secondary-color); } }
        
        @media print { body { -webkit-print-color-adjust: exact !important; color-adjust: exact !important; } body * { visibility: hidden; } #bill-content, #bill-content * { visibility: visible; } #bill-content { position: absolute; left: 0; top: 0; width: 100%; } .modal-buttons { display: none !important; } }
    </style>
</head>
<body>
    <!-- SVG Icons Definition -->
    <svg width="0" height="0" style="position:absolute"><defs><symbol id="icon-users" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></symbol><symbol id="icon-box" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></symbol><symbol id="icon-clipboard" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></symbol><symbol id="icon-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></symbol><symbol id="icon-truck" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></symbol><symbol id="icon-pie-chart" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8.11 2.99"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></symbol><symbol id="icon-wallet" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"></path><path d="M18 12a2 2 0 0 0 0 4h4v-4h-4z"></path></symbol></defs></svg>

    <div id="login-screen"><h1 id="login-header">PVR DISTRIBUTION</h1><div id="role-selection"><p>Select Role</p><button id="login-button"><svg class="icon"><use xlink:href="#icon-user"></use></svg><span>RIYAS</span></button></div></div>
    
    <div id="main-app">
        <div class="container">
            <div id="customers-page" class="page active"><h2 class="page-header"><svg class="icon"><use xlink:href="#icon-users"></use></svg> Customers</h2><ul id="customer-list" class="item-list"></ul><div class="fab" id="add-customer-btn">+</div></div>
            <div id="inventory-page" class="page"><h2 class="page-header"><svg class="icon"><use xlink:href="#icon-box"></use></svg> Inventory</h2><ul id="inventory-list" class="item-list"></ul><div class="fab" id="add-item-btn">+</div></div>
            <div id="orders-page" class="page"><h2 class="page-header"><svg class="icon"><use xlink:href="#icon-clipboard"></use></svg> Orders</h2><ul id="order-list" class="item-list"></ul></div>
            <div id="purchase-page" class="page"><h2 class="page-header"><svg class="icon"><use xlink:href="#icon-truck"></use></svg> Vendors</h2><ul id="vendor-list" class="item-list"></ul><div class="fab" id="add-vendor-btn">+</div></div>
            <div id="accounts-page" class="page"><h2 class="page-header"><svg class="icon"><use xlink:href="#icon-wallet"></use></svg> Accounts</h2><nav class="sub-nav"><div class="sub-nav-item active" data-subpage="receivables">Receivables</div><div class="sub-nav-item" data-subpage="payables">Payables</div></nav><div id="receivables-content" class="sub-page active"><ul class="item-list"></ul></div><div id="payables-content" class="sub-page"><ul class="item-list"></ul></div></div>
            <div id="reports-page" class="page"><h2 class="page-header"><svg class="icon"><use xlink:href="#icon-pie-chart"></use></svg> Reports</h2><div id="reports-content"></div></div>
            
            <div id="order-creation-page" class="page"><div class="page-sub-header"><h2>New Order for <span id="order-customer-name"></span></h2><div class="search-container"><input type="text" id="sales-search-bar" class="search-bar" placeholder="Search products..."><div id="sales-cart-icon" class="cart-icon">ðŸ›’ <span id="sales-cart-count" class="cart-count">0</span></div></div></div><div id="sales-product-grid" class="product-grid"></div></div>
            <div id="purchase-order-page" class="page"><div class="page-sub-header"><h2>New Purchase from <span id="purchase-vendor-name"></span></h2><div class="search-container"><input type="text" id="purchase-search-bar" class="search-bar" placeholder="Search products..."><div id="purchase-cart-icon" class="cart-icon">ðŸ›’ <span id="purchase-cart-count" class="cart-count">0</span></div></div></div><div id="purchase-product-grid" class="product-grid"></div></div>
        </div>
        
        <nav id="bottom-nav">
            <div class="nav-item active" data-page="customers-page"><svg class="icon"><use xlink:href="#icon-users"></use></svg> Customers</div>
            <div class="nav-item" data-page="inventory-page"><svg class="icon"><use xlink:href="#icon-box"></use></svg> Inventory</div>
            <div class="nav-item" data-page="orders-page"><svg class="icon"><use xlink:href="#icon-clipboard"></use></svg> Orders</div>
            <div class="nav-item" data-page="purchase-page"><svg class="icon"><use xlink:href="#icon-truck"></use></svg> Purchase</div>
            <div class="nav-item" data-page="accounts-page"><svg class="icon"><use xlink:href="#icon-wallet"></use></svg> Accounts</div>
            <div class="nav-item" data-page="reports-page"><svg class="icon"><use xlink:href="#icon-pie-chart"></use></svg> Reports</div>
        </nav>
    </div>

    <!-- Modals -->
    <div id="customer-modal" class="modal"><div class="modal-content"><h2 id="customer-modal-title">Add Customer</h2><input type="hidden" id="customer-id"><input type="text" id="customer-name" placeholder="Customer Name"><input type="tel" id="customer-phone" placeholder="Phone Number"><div class="modal-buttons"><button class="btn close-btn">Cancel</button><button class="btn save-btn" id="save-customer-btn">Save</button></div></div></div>
    <div id="vendor-modal" class="modal"><div class="modal-content"><h2>Add Vendor</h2><input type="text" id="vendor-name" placeholder="Vendor Name"><input type="tel" id="vendor-phone" placeholder="Phone Number"><div class="modal-buttons"><button class="btn close-btn">Cancel</button><button class="btn save-btn" id="save-vendor-btn">Save</button></div></div></div>
    <div id="inventory-modal" class="modal"><div class="modal-content"><h2 id="inventory-modal-title">Add Item</h2><input type="hidden" id="item-id"><input type="text" id="item-name" placeholder="Item Name"><input type="text" id="item-cost" placeholder="Last Cost" readonly><input type="number" id="item-mrp" placeholder="MRP"><input type="number" id="item-p1" placeholder="Price 1 (P1)"><input type="number" id="item-p2" placeholder="Price 2 (P2)"><div class="modal-buttons"><button class="btn close-btn">Cancel</button><button class="btn save-btn" id="save-item-btn">Save</button></div></div></div>
    <div id="sales-cart-modal" class="modal"><div class="modal-content"><h2>Your Cart</h2><ul id="sales-cart-items" class="cart-items-list"></ul><div id="sales-cart-total" class="cart-total">Total: â‚¹<span id="sales-cart-total-amount">0.00</span></div><div class="modal-buttons"><button class="btn close-btn">Close</button><button class="btn" id="confirm-order-btn">Confirm Order</button></div></div></div>
    <div id="purchase-cart-modal" class="modal"><div class="modal-content"><h2>Purchase Cart</h2><ul id="purchase-cart-items" class="cart-items-list"></ul><div id="purchase-cart-total" class="cart-total">Total: â‚¹<span id="purchase-cart-total-amount">0.00</span></div><div class="modal-buttons"><button class="btn close-btn">Close</button><button class="btn" id="confirm-purchase-btn">Confirm Purchase</button></div></div></div>
    <div id="bill-modal" class="modal"><div class="modal-content"><div id="bill-content"></div><div class="modal-buttons"><button class="btn close-btn">Close</button><button class="btn" id="download-bill-btn">Print Bill</button></div></div></div>
    <div id="success-animation"><svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/><path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg><p>Success!</p></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const getData = (key) => JSON.parse(localStorage.getItem(key)) || [];
        const saveData = (key, data) => localStorage.setItem(key, JSON.stringify(data));

        const initData = () => {
            if (!localStorage.getItem('pvr_customers')) saveData('pvr_customers', [{ id: Date.now(), name: 'Walk-in Customer', phone: '' }]);
            if (!localStorage.getItem('pvr_inventory')) saveData('pvr_inventory', [{ id: Date.now() + 1, name: 'Sample Product A', mrp: 100, p1: 90, p2: 85 }, { id: Date.now() + 2, name: 'Sample Product B', mrp: 250, p1: 220, p2: 210 }]);
            if (!localStorage.getItem('pvr_orders')) saveData('pvr_orders', []);
            if (!localStorage.getItem('pvr_vendors')) saveData('pvr_vendors', [{ id: Date.now(), name: 'Default Supplier', phone: '' }]);
            if (!localStorage.getItem('pvr_purchases')) saveData('pvr_purchases', []);
        };

        let currentOrderCustomer = null, salesCart = [], currentPurchaseVendor = null, purchaseCart = [];

        // --- Element Refs ---
        const loginScreen = document.getElementById('login-screen'), mainApp = document.getElementById('main-app');
        const pages = document.querySelectorAll('.page'), navItems = document.querySelectorAll('.nav-item'), allModals = document.querySelectorAll('.modal');
        const customerList = document.getElementById('customer-list'), customerModal = document.getElementById('customer-modal');
        const customerForm = { id: document.getElementById('customer-id'), name: document.getElementById('customer-name'), phone: document.getElementById('customer-phone'), btn: document.getElementById('save-customer-btn'), title: document.getElementById('customer-modal-title') };
        const inventoryList = document.getElementById('inventory-list'), inventoryModal = document.getElementById('inventory-modal');
        const itemForm = { id: document.getElementById('item-id'), name: document.getElementById('item-name'), mrp: document.getElementById('item-mrp'), cost: document.getElementById('item-cost'), p1: document.getElementById('item-p1'), p2: document.getElementById('item-p2'), btn: document.getElementById('save-item-btn'), title: document.getElementById('inventory-modal-title') };
        const orderList = document.getElementById('order-list'), orderCreationPage = document.getElementById('order-creation-page'), orderCustomerName = document.getElementById('order-customer-name');
        const salesProductGrid = document.getElementById('sales-product-grid'), salesSearchBar = document.getElementById('sales-search-bar');
        const salesCartIcon = document.getElementById('sales-cart-icon'), salesCartCount = document.getElementById('sales-cart-count'), salesCartModal = document.getElementById('sales-cart-modal'), salesCartItemsList = document.getElementById('sales-cart-items'), salesCartTotalAmountSpan = document.getElementById('sales-cart-total-amount'), confirmOrderBtn = document.getElementById('confirm-order-btn');
        const billModal = document.getElementById('bill-modal'), billContent = document.getElementById('bill-content');
        const vendorList = document.getElementById('vendor-list'), vendorModal = document.getElementById('vendor-modal');
        const vendorForm = { name: document.getElementById('vendor-name'), phone: document.getElementById('vendor-phone'), btn: document.getElementById('save-vendor-btn') };
        const purchaseOrderPage = document.getElementById('purchase-order-page'), purchaseVendorName = document.getElementById('purchase-vendor-name');
        const purchaseProductGrid = document.getElementById('purchase-product-grid'), purchaseSearchBar = document.getElementById('purchase-search-bar');
        const purchaseCartIcon = document.getElementById('purchase-cart-icon'), purchaseCartCount = document.getElementById('purchase-cart-count'), purchaseCartModal = document.getElementById('purchase-cart-modal'), purchaseCartItemsList = document.getElementById('purchase-cart-items'), purchaseCartTotalAmountSpan = document.getElementById('purchase-cart-total-amount'), confirmPurchaseBtn = document.getElementById('confirm-purchase-btn');
        const reportsContent = document.getElementById('reports-content');
        const accountsSubNav = document.querySelector('.sub-nav');
        const receivablesContent = document.getElementById('receivables-content').querySelector('.item-list');
        const payablesContent = document.getElementById('payables-content').querySelector('.item-list');
        
        // --- Render Functions ---
        const renderCustomers = () => { customerList.innerHTML = getData('pvr_customers').map(c => `<li class="list-item"><div><strong>${c.name}</strong><br><small>${c.phone}</small></div><button class="btn order-btn" data-id="${c.id}">Order</button></li>`).join(''); };
        const renderInventory = () => { inventoryList.innerHTML = getData('pvr_inventory').map(i => `<li class="list-item"><div><strong>${i.name}</strong><br><small>MRP: ${i.mrp} | P1: ${i.p1} | P2: ${i.p2}</small></div><button class="btn edit-btn" data-id="${i.id}">Edit</button></li>`).join(''); };
        const renderVendors = () => { vendorList.innerHTML = getData('pvr_vendors').map(v => `<li class="list-item"><div><strong>${v.name}</strong><br><small>${v.phone}</small></div><button class="btn purchase-btn" data-id="${v.id}">Purchase</button></li>`).join(''); };
        const renderOrders = () => { const orders = getData('pvr_orders').sort((a,b) => b.createdAt - a.createdAt); const customers = getData('pvr_customers'); orderList.innerHTML = orders.map(o => { const customer = customers.find(c => c.id === o.customerId); return `<li class="list-item"><div><strong>Invoice #${o.id} for ${customer ? customer.name : 'Unknown'}</strong><br><small>${new Date(o.createdAt).toLocaleString()} - Total: â‚¹${o.total.toFixed(2)}</small></div><button class="btn view-bill-btn" data-id="${o.id}">View Bill</button></li>`; }).join(''); };
        const renderReports = () => {
            const orders = getData('pvr_orders'); const purchases = getData('pvr_purchases'); const customers = getData('pvr_customers'); const inventory = getData('pvr_inventory');
            const allPurchasedItems = purchases.flatMap(p => p.items).sort((a, b) => a.createdAt - b.createdAt);
            const getCost = (itemId, orderTimestamp) => { const relevantPurchases = allPurchasedItems.filter(p => p.inventoryId === itemId && p.createdAt <= orderTimestamp); return relevantPurchases.length > 0 ? relevantPurchases[relevantPurchases.length - 1].cost : 0; };
            let totalSales = 0, totalCOGS = 0;
            orders.forEach(order => { totalSales += order.total; order.items.forEach(item => { totalCOGS += getCost(item.id, order.createdAt) * item.quantity; }); });
            const grossProfit = totalSales - totalCOGS;
            const productProfit = {}; inventory.forEach(inv => { productProfit[inv.id] = { name: inv.name, revenue: 0, cogs: 0 }; });
            orders.forEach(order => { order.items.forEach(item => { const itemRevenue = item.price * item.quantity; const itemCOGS = getCost(item.id, order.createdAt) * item.quantity; if(productProfit[item.id]) { productProfit[item.id].revenue += itemRevenue; productProfit[item.id].cogs += itemCOGS; } }); });
            const productProfitList = Object.values(productProfit).map(p => { const profit = p.revenue - p.cogs; const margin = p.revenue > 0 ? (profit / p.revenue) * 100 : 0; return { ...p, profit, margin }; }).sort((a,b) => b.profit - a.profit);
            const customerProfit = {}; customers.forEach(cust => { customerProfit[cust.id] = { name: cust.name, revenue: 0, cogs: 0 }; });
            orders.forEach(order => { if(customerProfit[order.customerId]) { let orderCOGS = 0; order.items.forEach(item => orderCOGS += getCost(item.id, order.createdAt) * item.quantity); customerProfit[order.customerId].revenue += order.total; customerProfit[order.customerId].cogs += orderCOGS; } });
            const customerProfitList = Object.values(customerProfit).map(c => { const profit = c.revenue - c.cogs; const margin = c.revenue > 0 ? (profit / c.revenue) * 100 : 0; return { ...c, profit, margin }; }).sort((a,b) => b.profit - a.profit);
            reportsContent.innerHTML = `<div class="kpi-grid"><div class="kpi-card sales"><h3>Total Sales</h3><div class="value">â‚¹${totalSales.toFixed(2)}</div></div><div class="kpi-card purchases"><h3>Total Cost</h3><div class="value">â‚¹${totalCOGS.toFixed(2)}</div></div><div class="kpi-card profit"><h3>Gross Profit</h3><div class="value">â‚¹${grossProfit.toFixed(2)}</div></div></div><div class="report-section"><h3>Profitability by Product</h3><table class="report-table"><thead><tr><th>Product</th><th>Revenue</th><th>Profit</th><th>Margin</th></tr></thead><tbody>${productProfitList.map(p => `<tr><td>${p.name}</td><td>â‚¹${p.revenue.toFixed(2)}</td><td>â‚¹${p.profit.toFixed(2)}</td><td>${p.margin.toFixed(1)}%</td></tr>`).join('')}</tbody></table></div><div class="report-section"><h3>Profitability by Customer</h3><table class="report-table"><thead><tr><th>Customer</th><th>Revenue</th><th>Profit</th><th>Margin</th></tr></thead><tbody>${customerProfitList.map(c => `<tr><td>${c.name}</td><td>â‚¹${c.revenue.toFixed(2)}</td><td>â‚¹${c.profit.toFixed(2)}</td><td>${c.margin.toFixed(1)}%</td></tr>`).join('')}</tbody></table></div>`;
        };
        const renderReceivables = () => { const customers = getData('pvr_customers'); const orders = getData('pvr_orders'); receivablesContent.innerHTML = customers.map(c => { const pendingAmount = orders.filter(o => o.customerId === c.id && o.status === 'unpaid').reduce((sum, o) => sum + o.total, 0); return `<li class="list-item"><div><strong>${c.name}</strong><br><small>Pending: â‚¹${pendingAmount.toFixed(2)}</small></div>${pendingAmount > 0 ? `<button class="btn mark-paid-btn" data-type="receivable" data-id="${c.id}">Mark as Paid</button>` : ''}</li>`; }).join(''); };
        const renderPayables = () => { const vendors = getData('pvr_vendors'); const purchases = getData('pvr_purchases'); payablesContent.innerHTML = vendors.map(v => { const pendingAmount = purchases.filter(p => p.vendorId === v.id && p.status === 'unpaid').reduce((sum, p) => sum + p.total, 0); return `<li class="list-item"><div><strong>${v.name}</strong><br><small>Pending: â‚¹${pendingAmount.toFixed(2)}</small></div>${pendingAmount > 0 ? `<button class="btn mark-paid-btn" data-type="payable" data-id="${v.id}">Mark as Paid</button>` : ''}</li>`; }).join(''); };
        const renderSalesProductGrid = (filter = '') => { salesProductGrid.innerHTML = getData('pvr_inventory').filter(i => i.name.toLowerCase().includes(filter.toLowerCase())).map(item => `<div class="product-tile"><div class="product-info"><span class="product-name">${item.name}</span><span class="product-mrp">MRP: â‚¹${item.mrp}</span></div><div class="product-actions" data-id="${item.id}" data-name="${item.name}"><div class="action-item"><button class="control price-btn" data-price="${item.p1}">${item.p1}</button><div class="label">P1</div></div><div class="action-item"><button class="control price-btn" data-price="${item.p2}">${item.p2}</button><div class="label">P2</div></div><div class="action-item"><input type="number" class="control custom-price" placeholder="Rate"><div class="label">Custom</div></div><div class="action-item"><input type="number" class="control quantity" value="1" min="1"><div class="label">Qty</div></div><div class="action-item"><button class="control add-to-cart-btn">Add</button><div class="label">&nbsp;</div></div></div></div>`).join(''); };
        const renderPurchaseProductGrid = (filter = '') => { purchaseProductGrid.innerHTML = getData('pvr_inventory').filter(i => i.name.toLowerCase().includes(filter.toLowerCase())).map(item => `<div class="product-tile"><div class="product-info"><span class="product-name">${item.name}</span></div><div class="purchase-actions" data-id="${item.id}" data-name="${item.name}"><div class="action-item"><input type="number" class="control purchase-cost" placeholder="Cost"><div class="label">Cost/Item</div></div><div class="action-item"><input type="number" class="control purchase-quantity" value="1" min="1"><div class="label">Qty</div></div><div class="action-item"><button class="control add-to-purchase-btn">Add</button><div class="label">&nbsp;</div></div></div></div>`).join(''); };
        
        // --- App Logic ---
        const navigateToPage = (pageId) => { if (orderCreationPage.classList.contains('active') || purchaseOrderPage.classList.contains('active')) { resetSalesPage(); resetPurchasePage(); } pages.forEach(p => p.classList.remove('active')); document.getElementById(pageId).classList.add('active'); navItems.forEach(nav => nav.classList.remove('active')); const nav = document.querySelector(`.nav-item[data-page="${pageId}"]`); if(nav) nav.classList.add('active'); if(pageId === 'reports-page') renderReports(); if(pageId === 'accounts-page') { renderReceivables(); renderPayables(); } };
        const openModal = (modal) => modal.style.display = 'block'; const closeModal = (modal) => modal.style.display = 'none';
        const resetSalesPage = () => { salesCart = []; currentOrderCustomer = null; salesSearchBar.value = ''; updateSalesCartUI(); };
        const resetPurchasePage = () => { purchaseCart = []; currentPurchaseVendor = null; purchaseSearchBar.value = ''; updatePurchaseCartUI(); };
        const updateSalesCartUI = () => { salesCartCount.innerText = salesCart.length; let total = 0; salesCartItemsList.innerHTML = salesCart.map((item, index) => { const itemTotal = item.price * item.quantity; total += itemTotal; return `<li><span>${item.name} (x${item.quantity})</span><div class="cart-item-details"><span>â‚¹${itemTotal.toFixed(2)}</span><button class="delete-cart-item-btn" data-type="sales" data-index="${index}">&#128465;</button></div></li>`; }).join(''); salesCartTotalAmountSpan.innerText = total.toFixed(2); };
        const updatePurchaseCartUI = () => { purchaseCartCount.innerText = purchaseCart.length; let total = 0; purchaseCartItemsList.innerHTML = purchaseCart.map((item, index) => { total += item.totalCost; return `<li><span>${item.name} (x${item.quantity} @ â‚¹${item.cost})</span><div class="cart-item-details"><span>â‚¹${item.totalCost.toFixed(2)}</span><button class="delete-cart-item-btn" data-type="purchase" data-index="${index}">&#128465;</button></div></li>`; }).join(''); purchaseCartTotalAmountSpan.innerText = total.toFixed(2); };
        const showSuccessAnimation = () => { const anim = document.getElementById('success-animation'); anim.style.display = 'block'; setTimeout(() => anim.style.display = 'none', 2000); };
        const generateAndShowBill = (order, customer) => { const itemsHtml = order.items.map((item, index) => `<tr><td>${index + 1}</td><td style="text-align: left;">${item.name}</td><td>${item.quantity}</td><td>â‚¹${item.price.toFixed(2)}</td><td>â‚¹${(item.quantity * item.price).toFixed(2)}</td></tr>`).join(''); billContent.innerHTML = `<div class="bill-container"><div class="bill-header"><h2>PVR DISTRIBUTION</h2><p>Your Trusted Partner</p></div><div class="bill-meta"><div><strong>Billed To:</strong><span>${customer ? customer.name : 'N/A'}</span><br><span>${customer ? customer.phone : ''}</span></div><div class="bill-meta-item"><strong>Invoice #</strong><span>${order.id}</span><strong>Date</strong><span>${new Date(order.createdAt).toLocaleDateString()}</span></div></div><table class="bill-table"><thead><tr><th style="width: 10%;">#</th><th style="text-align: left;">Item</th><th style="width: 15%;">Qty</th><th style="width: 20%;">Rate</th><th style="width: 20%;">Amount</th></tr></thead><tbody>${itemsHtml}</tbody></table><div class="bill-summary"><table><tbody><tr><td>Subtotal</td><td>â‚¹${order.total.toFixed(2)}</td></tr><tr class="total"><td>Total</td><td>â‚¹${order.total.toFixed(2)}</td></tr></tbody></table></div><div class="bill-footer"><p>Thank you for your business!</p></div></div>`; openModal(billModal); };
        
        // --- Event Listeners ---
        document.getElementById('login-button').addEventListener('click', () => { loginScreen.style.display = 'none'; mainApp.style.display = 'block'; initData(); renderCustomers(); renderInventory(); renderVendors(); renderOrders(); });
        navItems.forEach(item => item.addEventListener('click', () => navigateToPage(item.dataset.page)));
        allModals.forEach(modal => modal.addEventListener('click', (e) => { if (e.target.classList.contains('modal') || e.target.classList.contains('close-btn')) closeModal(modal); }));
        document.getElementById('add-customer-btn').addEventListener('click', () => { customerForm.title.innerText = "Add Customer"; customerForm.id.value = ''; customerForm.name.value = ''; customerForm.phone.value = ''; openModal(customerModal); });
        customerForm.btn.addEventListener('click', () => { const customers = getData('pvr_customers'); const newCustomer = { id: Date.now(), name: customerForm.name.value.trim(), phone: customerForm.phone.value.trim() }; if (!newCustomer.name) return alert('Customer name is required.'); customers.push(newCustomer); saveData('pvr_customers', customers); renderCustomers(); closeModal(customerModal); });
        document.getElementById('add-vendor-btn').addEventListener('click', () => openModal(vendorModal));
        vendorForm.btn.addEventListener('click', () => { const vendors = getData('pvr_vendors'); const newVendor = { id: Date.now(), name: vendorForm.name.value.trim(), phone: vendorForm.phone.value.trim() }; if(!newVendor.name) return alert('Vendor name required'); vendors.push(newVendor); saveData('pvr_vendors', vendors); renderVendors(); closeModal(vendorModal); vendorForm.name.value = ''; vendorForm.phone.value = ''; });
        document.getElementById('add-item-btn').addEventListener('click', () => { itemForm.title.innerText = "Add Item"; itemForm.id.value = ''; itemForm.name.value = ''; itemForm.mrp.value = ''; itemForm.cost.value = 'N/A'; itemForm.p1.value = ''; itemForm.p2.value = ''; openModal(inventoryModal); });
        inventoryList.addEventListener('click', e => { if (e.target.classList.contains('edit-btn')) { const inventory = getData('pvr_inventory'); const purchases = getData('pvr_purchases'); const itemId = parseInt(e.target.dataset.id); const item = inventory.find(i => i.id === itemId); if (item) { const allPurchasesForItem = purchases.flatMap(p => p.items).filter(pItem => pItem.inventoryId === itemId); let latestCost = 'N/A'; if (allPurchasesForItem.length > 0) { const latestPurchase = allPurchasesForItem.sort((a, b) => b.createdAt - a.createdAt)[0]; latestCost = `â‚¹${latestPurchase.cost.toFixed(2)}`; } itemForm.title.innerText = "Edit Item"; itemForm.id.value = item.id; itemForm.name.value = item.name; itemForm.mrp.value = item.mrp; itemForm.cost.value = latestCost; itemForm.p1.value = item.p1; itemForm.p2.value = item.p2; openModal(inventoryModal); } } });
        itemForm.btn.addEventListener('click', () => { let inventory = getData('pvr_inventory'); const itemData = { id: itemForm.id.value ? parseInt(itemForm.id.value) : Date.now(), name: itemForm.name.value.trim(), mrp: parseFloat(itemForm.mrp.value), p1: parseFloat(itemForm.p1.value), p2: parseFloat(itemForm.p2.value) }; if (!itemData.name || isNaN(itemData.mrp)) return alert('Name and MRP required.'); if (itemForm.id.value) inventory = inventory.map(i => i.id === itemData.id ? itemData : i); else inventory.push(itemData); saveData('pvr_inventory', inventory); renderInventory(); closeModal(inventoryModal); });
        customerList.addEventListener('click', e => { if (e.target.classList.contains('order-btn')) { currentOrderCustomer = getData('pvr_customers').find(c => c.id == e.target.dataset.id); if (currentOrderCustomer) { orderCustomerName.innerText = currentOrderCustomer.name; renderSalesProductGrid(); navigateToPage('order-creation-page'); } } });
        vendorList.addEventListener('click', e => { if(e.target.classList.contains('purchase-btn')) { currentPurchaseVendor = getData('pvr_vendors').find(v => v.id == e.target.dataset.id); if(currentPurchaseVendor) { purchaseVendorName.innerText = currentPurchaseVendor.name; renderPurchaseProductGrid(); navigateToPage('purchase-order-page'); } } });
        salesSearchBar.addEventListener('input', e => renderSalesProductGrid(e.target.value));
        purchaseSearchBar.addEventListener('input', e => renderPurchaseProductGrid(e.target.value));
        salesProductGrid.addEventListener('click', e => { const tile = e.target.closest('.product-tile'); if (!tile) return; const actionsDiv = tile.querySelector('.product-actions'); const allPriceBtns = actionsDiv.querySelectorAll('.price-btn'); const customPriceInput = actionsDiv.querySelector('.custom-price'); if (e.target.classList.contains('price-btn')) { allPriceBtns.forEach(btn => btn.classList.remove('selected')); e.target.classList.add('selected'); customPriceInput.value = ''; } if (e.target.classList.contains('add-to-cart-btn')) { const selectedBtn = actionsDiv.querySelector('.price-btn.selected'); let price = parseFloat(customPriceInput.value); if (selectedBtn && !price) price = parseFloat(selectedBtn.dataset.price); const quantity = parseInt(actionsDiv.querySelector('.quantity').value); if (isNaN(price) || price <= 0 || isNaN(quantity) || quantity <= 0) return alert("Please select or enter a valid price and quantity."); const item = { id: parseInt(actionsDiv.dataset.id), name: actionsDiv.dataset.name, price, quantity }; const existing = salesCart.find(ci => ci.id === item.id && ci.price === item.price); if (existing) existing.quantity += item.quantity; else salesCart.push(item); updateSalesCartUI(); customPriceInput.value = ''; actionsDiv.querySelector('.quantity').value = 1; allPriceBtns.forEach(b => b.classList.remove('selected')); } });
        salesProductGrid.addEventListener('input', e => { if (e.target.classList.contains('custom-price')) { const actionsDiv = e.target.closest('.product-actions'); actionsDiv.querySelectorAll('.price-btn').forEach(btn => btn.classList.remove('selected')); } });
        purchaseProductGrid.addEventListener('click', e => { const tile = e.target.closest('.product-tile'); if (!tile) return; if(e.target.classList.contains('add-to-purchase-btn')) { const actionsDiv = tile.querySelector('.purchase-actions'); const cost = parseFloat(actionsDiv.querySelector('.purchase-cost').value); const quantity = parseInt(actionsDiv.querySelector('.purchase-quantity').value); if(isNaN(cost) || isNaN(quantity) || cost <= 0 || quantity <= 0) return alert('Valid cost and quantity required.'); const item = { inventoryId: parseInt(actionsDiv.dataset.id), name: actionsDiv.dataset.name, cost, quantity, totalCost: cost * quantity, createdAt: Date.now() }; const existing = purchaseCart.find(ci => ci.inventoryId === item.inventoryId && ci.cost === item.cost); if(existing) { existing.quantity += item.quantity; existing.totalCost = existing.quantity * existing.cost; } else { purchaseCart.push(item); } updatePurchaseCartUI(); actionsDiv.querySelector('.purchase-cost').value = ''; actionsDiv.querySelector('.purchase-quantity').value = '1'; } });
        salesCartIcon.addEventListener('click', () => { if (salesCart.length > 0) openModal(salesCartModal); });
        purchaseCartIcon.addEventListener('click', () => { if (purchaseCart.length > 0) openModal(purchaseCartModal); });
        document.body.addEventListener('click', e => { if (e.target.classList.contains('delete-cart-item-btn')) { const type = e.target.dataset.type; const index = parseInt(e.target.dataset.index); if (type === 'sales') { salesCart.splice(index, 1); updateSalesCartUI(); if (salesCart.length === 0) closeModal(salesCartModal); } else if (type === 'purchase') { purchaseCart.splice(index, 1); updatePurchaseCartUI(); if (purchaseCart.length === 0) closeModal(purchaseCartModal); } } });
        confirmOrderBtn.addEventListener('click', () => { if (salesCart.length === 0) return; let orders = getData('pvr_orders'); const newOrder = { id: String(Date.now()).slice(-7), customerId: currentOrderCustomer.id, items: salesCart, total: parseFloat(salesCartTotalAmountSpan.innerText), createdAt: Date.now(), status: 'unpaid' }; orders.push(newOrder); saveData('pvr_orders', orders); closeModal(salesCartModal); showSuccessAnimation(); renderOrders(); setTimeout(() => navigateToPage('orders-page'), 1800); });
        confirmPurchaseBtn.addEventListener('click', () => { if (purchaseCart.length === 0) return; const purchases = getData('pvr_purchases'); const newPurchase = { id: Date.now(), vendorId: currentPurchaseVendor.id, items: purchaseCart, total: parseFloat(purchaseCartTotalAmountSpan.innerText), createdAt: Date.now(), status: 'unpaid' }; purchases.push(newPurchase); saveData('pvr_purchases', purchases); closeModal(purchaseCartModal); showSuccessAnimation(); setTimeout(() => navigateToPage('purchase-page'), 1800); });
        orderList.addEventListener('click', async e => { if (e.target.classList.contains('view-bill-btn')) { const order = getData('pvr_orders').find(o => o.id == e.target.dataset.id); if (order) { const customer = getData('pvr_customers').find(c => c.id === order.customerId); generateAndShowBill(order, customer); } } });
        accountsSubNav.addEventListener('click', e => { if(e.target.classList.contains('sub-nav-item')) { const subpage = e.target.dataset.subpage; document.querySelectorAll('.sub-nav-item').forEach(i => i.classList.remove('active')); e.target.classList.add('active'); document.querySelectorAll('.sub-page').forEach(p => p.classList.remove('active')); document.getElementById(`${subpage}-content`).classList.add('active'); } });
        document.body.addEventListener('click', e => { if(e.target.classList.contains('mark-paid-btn')) { const type = e.target.dataset.type; const id = parseInt(e.target.dataset.id); if(type === 'receivable') { let orders = getData('pvr_orders'); orders.forEach(o => { if(o.customerId === id) o.status = 'paid'; }); saveData('pvr_orders', orders); renderReceivables(); } else if (type === 'payable') { let purchases = getData('pvr_purchases'); purchases.forEach(p => { if(p.vendorId === id) p.status = 'paid'; }); saveData('pvr_purchases', purchases); renderPayables(); } } });
        document.getElementById('download-bill-btn').addEventListener('click', () => window.print());
    });
    </script>
</body>
</html>